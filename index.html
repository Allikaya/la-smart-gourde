import { useState, useEffect } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Carousel } from "@/components/ui/carousel";
import { Accordion, AccordionItem, AccordionTrigger, AccordionContent } from "@/components/ui/accordion";

const deliveryTimes = {
  FR: '3-5 jours ouvrés', DE: '2-4 jours ouvrés', US: '5-7 business days', CA: '3-4 jours ouvrés',
  IT: '3-4 jours ouvrés', ES: '3-4 jours ouvrés', UK: '4-6 jours ouvrés', NL: '3-4 jours ouvrés',
  BE: '2-4 jours ouvrés', CH: '4-6 jours ouvrés', PT: '3-4 jours ouvrés', SE: '4-6 jours ouvrés',
  NO: '3-5 jours ouvrés', FI: '3-5 jours ouvrés', DK: '4-6 jours ouvrés', JP: '7-10 business days',
  CN: '7-12 business days', AU: '4-8 jours ouvrés', BR: '8-12 jours ouvrés',
};

const paymentOptions = {
  default: ["visa", "mastercard", "paypal"],
  FR: ["visa", "mastercard", "paypal", "klarna", "oney"],
  DE: ["visa", "mastercard", "paypal", "klarna"],
  US: ["visa", "mastercard", "paypal"],
};

const translations = {
  fr: {
    slogan: "Restez hydraté, restez performant.",
    orderNow: "Commander maintenant",
    featuresTitle: "Fonctionnalités",
    specsTitle: "Fiche technique",
    buyTitle: "Acheter",
    monthlyPayment: "Paiement en 3x",
    addToCart: "Ajouter au panier",
    reviewsTitle: "Avis clients",
    contactTitle: "Contact",
    send: "Envoyer",
    delivery: "Délais de livraison",
    faq: [
      ["Quelle est la durée de la garantie ?", "2 ans de garantie constructeur."],
      ["Quels sont les délais de livraison ?", "Variable selon le pays (voir ci-dessus)."],
      ["Comment fonctionne l'application mobile ?", "Disponible sur iOS/Android, connexion Bluetooth."],
    ],
    legal: [
      ["Mentions légales", "Ce site est édité par SmartHydrate, SARL enregistrée à Lyon."],
      ["Politique de retour", "Retour sous 30 jours dans l'emballage d'origine."],
      ["Politique de confidentialité", "Vos données sont sécurisées et non revendues."],
    ]
  },
  en: {
    slogan: "Stay hydrated, stay sharp.",
    orderNow: "Order now",
    featuresTitle: "Features",
    specsTitle: "Specifications",
    buyTitle: "Buy",
    monthlyPayment: "Pay in 3x",
    addToCart: "Add to cart",
    reviewsTitle: "Customer reviews",
    contactTitle: "Contact",
    send: "Send",
    delivery: "Delivery Time",
    faq: [
      ["What is the warranty period?", "2-year manufacturer warranty."],
      ["How long is delivery?", "Depends on country (see above)."],
      ["How does the app work?", "iOS/Android app connects via Bluetooth."],
    ],
    legal: [
      ["Legal Notice", "This site is operated by SmartHydrate SARL, Lyon, France."],
      ["Return Policy", "Return within 30 days in original packaging."],
      ["Privacy Policy", "Your data is protected and never sold."],
    ]
  }
};

export default function App() {
  const [lang, setLang] = useState("fr");
  const [country, setCountry] = useState("FR");
  const [payment, setPayment] = useState("visa");

  useEffect(() => {
    const savedLang = localStorage.getItem("lang");
    const savedCountry = localStorage.getItem("country");
    const userLang = navigator.language.slice(0, 2);

    setLang(savedLang || (translations[userLang] ? userLang : "en"));
    if (savedCountry) setCountry(savedCountry);
  }, []);

  useEffect(() => {
    localStorage.setItem("lang", lang);
    localStorage.setItem("country", country);
  }, [lang, country]);

  const t = translations[lang];
  const paymentLogos = paymentOptions[country] || paymentOptions.default;

  return (
    <div className="p-4">
      <div className="flex justify-between items-center mb-4">
        <select value={lang} onChange={(e) => setLang(e.target.value)}>
          {Object.keys(translations).map(code => (
            <option key={code} value={code}>{code.toUpperCase()}</option>
          ))}
        </select>

        <select value={country} onChange={(e) => setCountry(e.target.value)}>
          {Object.keys(deliveryTimes).map(code => (
            <option key={code} value={code}>{code}</option>
          ))}
        </select>
      </div>

      <h1 className="text-3xl font-bold mb-2">{t.slogan}</h1>
      <Carousel images={["main.jpg", "view1.jpg", "view2.jpg"]} />
      <Button className="my-4">{t.orderNow}</Button>

      <Card className="my-4">
        <CardContent>
          <h2 className="text-xl font-semibold mb-2">{t.delivery}</h2>
          <p>{deliveryTimes[country] || "N/A"}</p>
        </CardContent>
      </Card>

      <h2 className="text-xl font-semibold mt-6">{t.buyTitle}</h2>
      <select value={payment} onChange={(e) => setPayment(e.target.value)}>
        {paymentLogos.map(method => (
          <option key={method} value={method}>{method.toUpperCase()}</option>
        ))}
      </select>
      <div className="flex gap-2 mt-2 items-center">
        <img src={`images/${payment}.png`} alt={`${payment} logo`} className="h-8" />
        {(payment === 'paypal' || payment === 'klarna' || payment === 'oney') && (
          <p>{t.monthlyPayment}: 3 x 19,99€</p>
        )}
      </div>

      <Accordion type="multiple" className="mt-6">
        {t.faq.map(([q, a], i) => (
          <AccordionItem key={`faq${i}`} value={`faq${i}`}>
            <AccordionTrigger>{q}</AccordionTrigger>
            <AccordionContent>{a}</AccordionContent>
          </AccordionItem>
        ))}
        {t.legal.map(([q, a], i) => (
          <AccordionItem key={`legal${i}`} value={`legal${i}`}>
            <AccordionTrigger>{q}</AccordionTrigger>
            <AccordionContent>{a}</AccordionContent>
          </AccordionItem>
        ))}
      </Accordion>
    </div>
  );
}
